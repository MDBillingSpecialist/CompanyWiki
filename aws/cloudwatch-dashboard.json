{
  "widgets": [
    {
      "type": "text",
      "x": 0,
      "y": 0,
      "width": 24,
      "height": 1,
      "properties": {
        "markdown": "# Company Wiki Monitoring Dashboard\nThis dashboard provides comprehensive monitoring for the Company Wiki application deployed on AWS App Runner and ECS."
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 1,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          ["AWS/ECS", "CPUUtilization", "ServiceName", "company-wiki-service", "ClusterName", "company-wiki-cluster", { "stat": "Average" }]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${AWS::Region}",
        "title": "ECS CPU Utilization",
        "period": 300,
        "yAxis": {
          "left": {
            "min": 0,
            "max": 100
          }
        },
        "annotations": {
          "horizontal": [
            {
              "label": "Warning",
              "value": 75,
              "color": "#ff9900"
            },
            {
              "label": "Critical",
              "value": 90,
              "color": "#d13212"
            }
          ]
        }
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 1,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          ["AWS/ECS", "MemoryUtilization", "ServiceName", "company-wiki-service", "ClusterName", "company-wiki-cluster", { "stat": "Average" }]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${AWS::Region}",
        "title": "ECS Memory Utilization",
        "period": 300,
        "yAxis": {
          "left": {
            "min": 0,
            "max": 100
          }
        },
        "annotations": {
          "horizontal": [
            {
              "label": "Warning",
              "value": 75,
              "color": "#ff9900"
            },
            {
              "label": "Critical",
              "value": 90,
              "color": "#d13212"
            }
          ]
        }
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 7,
      "width": 24,
      "height": 6,
      "properties": {
        "metrics": [
          ["AWS/ApplicationELB", "RequestCount", "LoadBalancer", "${LoadBalancer.LoadBalancerFullName}", { "stat": "Sum", "period": 60 }],
          [".", "HTTPCode_Target_2XX_Count", ".", ".", { "stat": "Sum", "period": 60 }],
          [".", "HTTPCode_Target_4XX_Count", ".", ".", { "stat": "Sum", "period": 60 }],
          [".", "HTTPCode_Target_5XX_Count", ".", ".", { "stat": "Sum", "period": 60 }]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${AWS::Region}",
        "title": "Request Count and Status Codes",
        "period": 300
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 13,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          ["AWS/ApplicationELB", "TargetResponseTime", "LoadBalancer", "${LoadBalancer.LoadBalancerFullName}", { "stat": "Average", "period": 60 }],
          ["...", { "stat": "p90", "period": 60 }],
          ["...", { "stat": "p95", "period": 60 }],
          ["...", { "stat": "p99", "period": 60 }]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${AWS::Region}",
        "title": "Response Times",
        "period": 300
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 13,
      "width": 12,
      "height": 6,
      "properties": {
        "metrics": [
          ["AWS/ApplicationELB", "HealthyHostCount", "TargetGroup", "${TargetGroup.TargetGroupFullName}", "LoadBalancer", "${LoadBalancer.LoadBalancerFullName}", { "stat": "Average" }],
          [".", "UnHealthyHostCount", ".", ".", ".", ".", { "stat": "Average" }]
        ],
        "view": "timeSeries",
        "stacked": false,
        "region": "${AWS::Region}",
        "title": "Target Health",
        "period": 300
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 19,
      "width": 12,
      "height": 6,
      "properties": {
        "view": "timeSeries",
        "stacked": false,
        "metrics": [
          ["AWS/AppRunner", "ProcessingTime", "ServiceName", "${ServiceName}", { "stat": "Average" }],
          [".", "RequestCount", ".", ".", { "stat": "Sum" }]
        ],
        "region": "${AWS::Region}",
        "title": "App Runner Request Statistics",
        "period": 300
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 19,
      "width": 12,
      "height": 6,
      "properties": {
        "view": "timeSeries",
        "stacked": false,
        "metrics": [
          ["AWS/AppRunner", "5xxErrorPercentage", "ServiceName", "${ServiceName}", { "stat": "Average" }],
          [".", "4xxErrorPercentage", ".", ".", { "stat": "Average" }]
        ],
        "region": "${AWS::Region}",
        "title": "App Runner Error Rates",
        "period": 300
      }
    },
    {
      "type": "log",
      "x": 0,
      "y": 25,
      "width": 24,
      "height": 6,
      "properties": {
        "query": "SOURCE '/aws/apprunner/${ServiceName}/application' | fields @timestamp, @message\n| filter @message like /ERROR/ or @message like /WARN/\n| sort @timestamp desc\n| limit 20",
        "region": "${AWS::Region}",
        "title": "Recent Error Logs",
        "view": "table"
      }
    },
    {
      "type": "alarm",
      "x": 0,
      "y": 31,
      "width": 24,
      "height": 6,
      "properties": {
        "title": "CloudWatch Alarms",
        "alarms": [
          "arn:aws:cloudwatch:${AWS::Region}:${AWS::AccountId}:alarm:company-wiki-cpu-alarm",
          "arn:aws:cloudwatch:${AWS::Region}:${AWS::AccountId}:alarm:company-wiki-memory-alarm",
          "arn:aws:cloudwatch:${AWS::Region}:${AWS::AccountId}:alarm:company-wiki-5xx-alarm",
          "arn:aws:cloudwatch:${AWS::Region}:${AWS::AccountId}:alarm:company-wiki-health-alarm",
          "arn:aws:cloudwatch:${AWS::Region}:${AWS::AccountId}:alarm:company-wiki-response-alarm"
        ]
      }
    },
    {
      "type": "metric",
      "x": 0,
      "y": 37,
      "width": 12,
      "height": 6,
      "properties": {
        "view": "timeSeries",
        "stacked": false,
        "metrics": [
          ["AWS/AppRunner", "InstanceResponseTime", "ServiceName", "${ServiceName}", "Path", "/health", { "stat": "Average" }],
          ["...", { "stat": "p90" }]
        ],
        "region": "${AWS::Region}",
        "title": "Health Endpoint Response Time",
        "period": 300
      }
    },
    {
      "type": "metric",
      "x": 12,
      "y": 37,
      "width": 12,
      "height": 6,
      "properties": {
        "view": "timeSeries",
        "stacked": false,
        "metrics": [
          ["AWS/AppRunner", "InstanceResponseTime", "ServiceName", "${ServiceName}", "Path", "/api/content", { "stat": "Average" }],
          ["...", { "stat": "p90" }]
        ],
        "region": "${AWS::Region}",
        "title": "API Endpoint Response Time",
        "period": 300
      }
    }
  ]
}